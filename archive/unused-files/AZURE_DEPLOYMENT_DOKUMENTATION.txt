# ZEITERFASSUNG AZURE DEPLOYMENT DOKUMENTATION
==================================================

## ğŸ“… ERSTELLT AM: 05.08.2025 13:26 Uhr
## ğŸ”„ VERSION: VollstÃ¤ndige App mit Datenbank-Integration
## ğŸŒ LIVE URL: https://zeiterfassung-app.azurewebsites.net

## ğŸ“‹ PROJEKTÃœBERSICHT
=====================

### Anwendung: Zeiterfassung-System fÃ¼r Monteure und BÃ¼ro
- **Frontend:** React.js mit modernem UI/UX
- **Backend:** Flask (Python) mit SQLite-Datenbank
- **Deployment:** Azure App Service (B1 Tier)
- **Datenbank:** SQLite (eingebettet in App Service)

### Benutzer-Rollen:
- **Monteur:** Zeiterfassung, AuftrÃ¤ge, Arbeitszeit-Tracking
- **BÃ¼ro:** Auftragsverwaltung, Notfall-Management, Monteur-Verwaltung

## ğŸš€ AZURE DEPLOYMENT DETAILS
==============================

### Resource Group:
- **Name:** zeiterfassung-rg
- **Location:** North Europe
- **Erstellt:** 05.08.2025

### App Service:
- **Name:** zeiterfassung-app
- **URL:** https://zeiterfassung-app.azurewebsites.net
- **Tier:** B1 (Basic)
- **Runtime:** Python 3.11
- **Startup Command:** gunicorn --bind=0.0.0.0 --timeout 600 app_with_db:app

### Datenbank:
- **Typ:** SQLite (eingebettet)
- **Datei:** zeiterfassung.db
- **Tabellen:** users, time_entries, orders, emergencies, customers

## ğŸ”‘ LOGIN-DATEN
==================

### Monteur:
- **Email:** monteur
- **Password:** monteur
- **Rolle:** monteur

### BÃ¼ro:
- **Email:** buero
- **Password:** buero
- **Rolle:** buero

## ğŸ“ PROJEKTSTRUKTUR
=====================

```
zeiterfassung-clean/
â”œâ”€â”€ frontend/                    # React Frontend
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ MonteurDashboard.js
â”‚   â”‚   â”‚   â”œâ”€â”€ MonteurDashboard.css
â”‚   â”‚   â”‚   â”œâ”€â”€ BueroDashboard.js
â”‚   â”‚   â”‚   â””â”€â”€ BueroDashboard.css
â”‚   â”‚   â””â”€â”€ App.js
â”‚   â””â”€â”€ build/                   # Production Build
â”œâ”€â”€ backend/                     # Flask Backend
â”‚   â”œâ”€â”€ app_with_db.py          # Haupt-App mit Datenbank
â”‚   â”œâ”€â”€ database_setup.py       # Datenbank-Initialisierung
â”‚   â”œâ”€â”€ startup.sh              # Azure Startup Script
â”‚   â”œâ”€â”€ requirements.txt        # Python Dependencies
â”‚   â”œâ”€â”€ zeiterfassung.db        # SQLite Datenbank
â”‚   â””â”€â”€ build/                  # Frontend Build (kopiert)
â””â”€â”€ AZURE_DEPLOYMENT_DOKUMENTATION.txt
```

## ğŸ› ï¸ DEPLOYMENT COMMANDS
=========================

### 1. Resource Group erstellen:
```bash
az group create --name zeiterfassung-rg --location "North Europe"
```

### 2. App Service erstellen:
```bash
az webapp create --resource-group zeiterfassung-rg --name zeiterfassung-app --plan zeiterfassung-plan --runtime "PYTHON|3.11"
```

### 3. App Service konfigurieren:
```bash
az webapp config set --resource-group zeiterfassung-rg --name zeiterfassung-app --startup-file "gunicorn --bind=0.0.0.0 --timeout 600 app_with_db:app"
```

### 4. Deployment durchfÃ¼hren:
```bash
# Frontend bauen
cd frontend && npm run build

# Build in Backend kopieren
cd ../backend && rm -rf build && cp -r ../frontend/build .

# ZIP erstellen
zip -r ../zeiterfassung-deployment.zip .

# Deployen
az webapp deploy --resource-group zeiterfassung-rg --name zeiterfassung-app --src-path zeiterfassung-deployment.zip
```

## ğŸ”§ KONFIGURATION
===================

### Backend (app_with_db.py):
- **Flask App** mit CORS-UnterstÃ¼tzung
- **SQLite-Datenbank** Integration
- **Session-Management** fÃ¼r Login
- **API-Endpunkte** fÃ¼r alle Funktionen
- **Frontend-Serving** fÃ¼r React App

### Frontend:
- **React.js** mit modernem UI
- **Axios** fÃ¼r API-Calls
- **Responsive Design** fÃ¼r alle GerÃ¤te
- **Zwei Dashboards:** Monteur und BÃ¼ro

### Datenbank-Schema:
```sql
-- Users Tabelle
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    email TEXT UNIQUE NOT NULL,
    password TEXT NOT NULL,
    name TEXT NOT NULL,
    role TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Time Entries Tabelle
CREATE TABLE time_entries (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    clock_in TIMESTAMP,
    clock_out TIMESTAMP,
    break_start TIMESTAMP,
    break_end TIMESTAMP,
    location TEXT,
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users (id)
);

-- Orders Tabelle
CREATE TABLE orders (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    description TEXT,
    customer TEXT,
    location TEXT,
    order_type TEXT,
    priority TEXT,
    status TEXT,
    assigned_to INTEGER,
    created_date DATE,
    due_date DATE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (assigned_to) REFERENCES users (id)
);

-- Emergencies Tabelle
CREATE TABLE emergencies (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    description TEXT,
    location TEXT,
    priority TEXT,
    status TEXT,
    assigned_to INTEGER,
    reported_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (assigned_to) REFERENCES users (id)
);

-- Customers Tabelle
CREATE TABLE customers (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    contact_person TEXT,
    email TEXT,
    phone TEXT,
    address TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## ğŸ“¡ API-ENDPUNKTE
===================

### Authentication:
- `POST /api/auth/login` - Benutzer anmelden
- `POST /api/auth/logout` - Benutzer abmelden
- `GET /api/auth/me` - Aktueller Benutzer

### Monteur Endpoints:
- `GET /api/monteur/time-entries` - ZeiteintrÃ¤ge abrufen
- `POST /api/monteur/clock-in` - Einstempeln
- `POST /api/monteur/clock-out` - Ausstempeln
- `GET /api/monteur/current-status` - Aktueller Status
- `GET /api/monteur/orders` - AuftrÃ¤ge abrufen
- `PUT /api/monteur/orders/{id}/status` - Auftragsstatus Ã¤ndern

### BÃ¼ro Endpoints:
- `GET /api/buero/orders` - Alle AuftrÃ¤ge
- `POST /api/buero/orders` - Auftrag erstellen
- `PUT /api/buero/orders/{id}` - Auftrag aktualisieren
- `GET /api/buero/emergencies` - NotfÃ¤lle abrufen
- `POST /api/buero/emergencies` - Notfall erstellen
- `GET /api/buero/customers` - Kunden abrufen
- `GET /api/buero/users` - Benutzer abrufen

## ğŸ” TROUBLESHOOTING
=====================

### HÃ¤ufige Probleme:

#### 1. "Application Error" auf Azure:
```bash
# Logs anzeigen
az webapp log tail --resource-group zeiterfassung-rg --name zeiterfassung-app

# App neu starten
az webapp restart --resource-group zeiterfassung-rg --name zeiterfassung-app
```

#### 2. Login-Probleme:
- Browser-Cache leeren (Ctrl+F5)
- Inkognito-Modus verwenden
- Hard Refresh durchfÃ¼hren

#### 3. Deployment hÃ¤ngt:
```bash
# Deployment abbrechen
az webapp deployment source config-zip --resource-group zeiterfassung-rg --name zeiterfassung-app --src zeiterfassung-deployment.zip --timeout 300
```

#### 4. Datenbank-Probleme:
```bash
# Datenbank neu initialisieren
cd backend && python3 database_setup.py
```

### Debugging Commands:
```bash
# App Status prÃ¼fen
curl https://zeiterfassung-app.azurewebsites.net/health

# Login testen
curl -X POST https://zeiterfassung-app.azurewebsites.net/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"monteur","password":"monteur"}'

# App Settings anzeigen
az webapp config appsettings list --resource-group zeiterfassung-rg --name zeiterfassung-app
```

## ğŸ“Š MONITORING
================

### Azure Portal:
- **URL:** https://portal.azure.com
- **Resource Group:** zeiterfassung-rg
- **App Service:** zeiterfassung-app

### Logs:
- **Application Logs:** Azure Portal â†’ App Service â†’ Logs
- **Live Logs:** `az webapp log tail --resource-group zeiterfassung-rg --name zeiterfassung-app`

### Metriken:
- **CPU Usage:** Azure Portal â†’ App Service â†’ Metrics
- **Memory Usage:** Azure Portal â†’ App Service â†’ Metrics
- **Response Time:** Azure Portal â†’ App Service â†’ Metrics

## ğŸ”„ UPDATE-PROZESS
====================

### Frontend Updates:
```bash
# 1. Frontend bauen
cd frontend && npm run build

# 2. Build in Backend kopieren
cd ../backend && rm -rf build && cp -r ../frontend/build .

# 3. ZIP erstellen
zip -r ../zeiterfassung-update.zip .

# 4. Deployen
az webapp deploy --resource-group zeiterfassung-rg --name zeiterfassung-app --src-path zeiterfassung-update.zip
```

### Backend Updates:
```bash
# 1. ZIP erstellen
cd backend && zip -r ../zeiterfassung-backend-update.zip .

# 2. Deployen
az webapp deploy --resource-group zeiterfassung-rg --name zeiterfassung-app --src-path zeiterfassung-backend-update.zip
```

### Datenbank-Updates:
```bash
# 1. Datenbank-Setup ausfÃ¼hren
cd backend && python3 database_setup.py

# 2. Mit Backend deployen
zip -r ../zeiterfassung-db-update.zip .
az webapp deploy --resource-group zeiterfassung-rg --name zeiterfassung-app --src-path zeiterfassung-db-update.zip
```

## ğŸ’° KOSTEN
============

### Azure App Service (B1):
- **Monatlich:** ~$13.14 USD
- **Features:** 1 Core, 1.75 GB RAM, 10 GB Storage
- **SLA:** 99.95%

### Optimierung:
- **Downscaling:** F1 (Free) fÃ¼r Entwicklung
- **Upscaling:** B2/B3 fÃ¼r hÃ¶here Last
- **Database:** Azure SQL Database fÃ¼r Produktion

## ğŸ”’ SICHERHEIT
================

### Implementierte Sicherheit:
- **HTTPS:** Automatisch von Azure bereitgestellt
- **Session-Management:** Flask-Sessions mit Secret Key
- **CORS:** Konfiguriert fÃ¼r Azure Domain
- **Input Validation:** Alle API-Endpunkte validiert

### Empfohlene Verbesserungen:
- **Password Hashing:** bcrypt fÃ¼r PasswÃ¶rter
- **JWT Tokens:** Statt Session-basiert
- **Rate Limiting:** API Rate Limiting
- **Logging:** Detailliertes Logging fÃ¼r Audit

## ğŸ“ SUPPORT
==============

### Bei Problemen:
1. **Logs prÃ¼fen:** Azure Portal â†’ App Service â†’ Logs
2. **Health Check:** https://zeiterfassung-app.azurewebsites.net/health
3. **Backup wiederherstellen:** Aus Backup-Ordner deployen
4. **Datenbank zurÃ¼cksetzen:** database_setup.py ausfÃ¼hren

### Kontakt:
- **Azure Support:** Ãœber Azure Portal
- **Dokumentation:** Diese Datei als Referenz
- **Backup:** VollstÃ¤ndige App in Backup-Ordner

## âœ… STATUS
============

### âœ… Funktioniert:
- [x] Login/Logout fÃ¼r beide Benutzer
- [x] Monteur Dashboard mit Zeiterfassung
- [x] BÃ¼ro Dashboard mit Auftragsverwaltung
- [x] Datenbank-Integration
- [x] Responsive Design
- [x] Azure Deployment
- [x] API-Endpunkte
- [x] Session-Management

### ğŸ”„ Geplant fÃ¼r Updates:
- [ ] Password Hashing
- [ ] Erweiterte Berichte
- [ ] Email-Benachrichtigungen
- [ ] Mobile App
- [ ] Azure SQL Database
- [ ] Backup-Automatisierung

## ğŸ“ CHANGELOG
================

### Version 1.0 (05.08.2025):
- âœ… VollstÃ¤ndige App implementiert
- âœ… Azure Deployment erfolgreich
- âœ… Datenbank-Integration
- âœ… Monteur und BÃ¼ro Dashboards
- âœ… Responsive Design
- âœ… API-Endpunkte
- âœ… Session-Management

---

**DOKUMENTATION ERSTELLT AM:** 05.08.2025 13:26 Uhr
**VERSION:** 1.0
**STATUS:** Produktiv auf Azure 