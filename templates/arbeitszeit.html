<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbeitszeitverwaltung</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <header class="bg-[#0066b3] shadow-lg mb-8">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="logo-container flex items-center">
                <img src="https://lackner-aufzuege-gmbh.com/wp-content/uploads/2021/09/cropped-2205_lackner_r.png" alt="Lackner Aufzüge Logo" style="height:48px;">
            </div>
            <div class="flex items-center">
                <a href="/dashboard" class="text-white font-semibold px-4 py-2 rounded hover:bg-blue-800">Dashboard</a>
            </div>
        </div>
    </header>
    <main class="container mx-auto px-4 py-8">
        <h1 class="text-2xl font-bold mb-6">Arbeitszeitverwaltung</h1>
        <form method="post" class="bg-white rounded-lg shadow-md p-6 mb-8 flex flex-wrap gap-4 items-end" id="arbeitszeit-form">
            <div>
                <label class="block text-sm font-medium mb-1">Startzeit</label>
                <input type="date" name="datum" class="border rounded px-2 py-1" id="start-datum" required>
                <input type="time" name="start" class="border rounded px-2 py-1 mt-1" id="start-uhrzeit" required>
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Endzeit</label>
                <input type="date" name="datum2" class="border rounded px-2 py-1" id="stop-datum" required>
                <input type="time" name="stop" class="border rounded px-2 py-1 mt-1" id="stop-uhrzeit" required>
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Dauer (h:mm)</label>
                <input type="text" name="dauer" class="border rounded px-2 py-1" id="dauer-feld" placeholder="z.B. 4:30" readonly required>
            </div>
            <div class="flex items-center gap-2">
                <input type="checkbox" name="notdienstwoche" value="1" class="h-5 w-5 text-blue-600 border-gray-300 rounded">
                <label class="text-sm">Notdienstwoche</label>
            </div>
            <div class="flex-1">
                <label class="block text-sm font-medium mb-1">Bemerkung</label>
                <input type="text" name="bemerkung" class="border rounded px-2 py-1 w-full">
            </div>
            <button type="submit" class="bg-[#0066b3] hover:bg-[#005a9e] text-white font-semibold px-6 py-2 rounded">Eintrag hinzufügen</button>
        </form>
        <form method="get" class="mb-4 flex gap-2">
            <input type="text" name="q" value="{{ q }}" placeholder="Suche..." class="border rounded px-2 py-1 flex-1">
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Suchen</button>
            <a href="/arbeitszeit/export" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Export (CSV)</a>
        </form>
        <div class="bg-white rounded-lg shadow-md p-4">
            <table class="min-w-full table-auto">
                <thead>
                    <tr class="bg-gray-100">
                        <th class="px-2 py-1 text-left text-xs font-semibold">Datum</th>
                        <th class="px-2 py-1 text-left text-xs font-semibold">Start</th>
                        <th class="px-2 py-1 text-left text-xs font-semibold">Ende</th>
                        <th class="px-2 py-1 text-left text-xs font-semibold">Dauer</th>
                        <th class="px-2 py-1 text-left text-xs font-semibold">Notdienst</th>
                        <th class="px-2 py-1 text-left text-xs font-semibold">Quelle</th>
                        <th class="px-2 py-1 text-left text-xs font-semibold">Bemerkung</th>
                    </tr>
                </thead>
                <tbody>
                    {% for e in eintraege %}
                    <tr class="border-b">
                        <td class="px-2 py-1">{{ e.datum if e.datum is defined and e.datum else (e.start.split('T')[0] if e.start and 'T' in e.start else (e.start if e.start and e.start|length == 10 and '-' in e.start else '')) }}</td>
                        <td class="px-2 py-1">{{ e.start }}</td>
                        <td class="px-2 py-1">{{ e.stop }}</td>
                        <td class="px-2 py-1">{{ e.dauer }}</td>
                        <td class="px-2 py-1">{% if e.notdienstwoche == '1' %}Ja{% else %}Nein{% endif %}</td>
                        <td class="px-2 py-1">{{ e.quelle }}</td>
                        <td class="px-2 py-1">{{ e.bemerkung }}</td>
                    </tr>
                    {% else %}
                    <tr><td colspan="7" class="text-center text-gray-400 py-4">Keine Einträge gefunden.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </main>
    <script>
function calcDauer() {
    const startDatum = document.getElementById('start-datum').value;
    const startUhr = document.getElementById('start-uhrzeit').value;
    const stopDatum = document.getElementById('stop-datum').value;
    const stopUhr = document.getElementById('stop-uhrzeit').value;
    if (startDatum && startUhr && stopDatum && stopUhr) {
        const start = new Date(startDatum + 'T' + startUhr);
        const stop = new Date(stopDatum + 'T' + stopUhr);
        let diff = Math.floor((stop - start) / 1000);
        if (diff < 0) diff = 0;
        const h = Math.floor(diff / 3600);
        const m = Math.floor((diff % 3600) / 60);
        document.getElementById('dauer-feld').value = h + ':' + (m < 10 ? '0' : '') + m;
    }
}
document.getElementById('start-datum').addEventListener('change', calcDauer);
document.getElementById('start-uhrzeit').addEventListener('change', calcDauer);
document.getElementById('stop-datum').addEventListener('change', calcDauer);
document.getElementById('stop-uhrzeit').addEventListener('change', calcDauer);
</script>
</body>
</html> 