<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zeiteinträge genehmigen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        :root {
            --lackner-blue: #0066b3;
            --lackner-blue-dark: #005a9e;
            --lackner-gray: #6c757d;
        }
        .lackner-blue { background: var(--lackner-blue); }
        .lackner-blue-text { color: var(--lackner-blue); }
        .btn-primary {
            background: var(--lackner-blue);
            color: white;
            border-radius: 0.375rem;
            padding: 0.5rem 1.25rem;
            font-weight: 600;
            transition: background 0.2s;
        }
        .btn-primary:hover { background: var(--lackner-blue-dark); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="min-h-screen flex flex-col">
        <header class="lackner-blue shadow-lg">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <div class="logo-container flex items-center">
                    <img src="https://lackner-aufzuege-gmbh.com/wp-content/uploads/2021/09/cropped-2205_lackner_r.png" alt="Lackner Aufzüge Logo" style="height:48px;">
                </div>
                <div class="flex items-center">
                    <div class="text-white text-sm mr-4 hidden md:block">
                        <span id="current-date" class="mr-2">{{ today }}</span>
                        <span id="current-time"></span>
                    </div>
                    <!-- Notification Center Glocke -->
                    <div class="relative mr-4">
                        <button id="notification-bell" class="focus:outline-none">
                            <svg class="h-7 w-7 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                            </svg>
                            {% if pending_count > 0 %}
                            <span class="absolute -top-1 -right-1 bg-red-600 text-white text-xs font-bold rounded-full px-2 py-0.5 border-2 border-white">{{ pending_count }}</span>
                            {% endif %}
                        </button>
                        <div id="notification-dropdown" class="hidden absolute right-0 mt-2 w-72 bg-white rounded-md shadow-lg py-2 z-20">
                            <a href="{{ url_for('approve_entries') }}" class="block px-4 py-3 text-gray-800 hover:bg-gray-100 cursor-pointer">
                                {% if pending_count > 0 %}
                                <span class="font-semibold">Es gibt {{ pending_count }} Zeiteinträge, die genehmigt werden müssen.</span>
                                {% else %}
                                <span>Keine neuen Benachrichtigungen.</span>
                                {% endif %}
                            </a>
                        </div>
                    </div>
                    <!-- Burger-Menü -->
                    <div class="relative">
                        <button id="burger-menu-button" class="ml-2 flex items-center text-white focus:outline-none" aria-label="Menü öffnen">
                            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                        <div id="burger-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-30">
                            <a href="{{ url_for('dashboard') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Startseite</a>
                            <a href="{{ url_for('approve_entries') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Zeiteinträge genehmigen</a>
                            <a href="{{ url_for('urlaub') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Urlaubsübersicht</a>
                            <a href="{{ url_for('manage_users') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Benutzerverwaltung</a>
                            <a href="{{ url_for('meine_auftraege') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Meine Aufträge heute</a>
                            <a href="{{ url_for('logout') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Abmelden</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <main class="flex-grow container mx-auto px-4 py-8">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <form id="filter-form" class="flex flex-wrap gap-4 items-end">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Mitarbeiter</label>
                        <select name="employee" id="filter-employee" class="form-input w-48 px-3 py-2 border border-gray-300 rounded-md">
                            <option value="">Alle</option>
                            {% for mitarbeiter in mitarbeiter_liste %}
                            <option value="{{ mitarbeiter }}">{{ mitarbeiter }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Zeitraum</label>
                        <input type="date" name="start" id="filter-start" class="form-input px-3 py-2 border border-gray-300 rounded-md">
                        <span class="mx-2">bis</span>
                        <input type="date" name="end" id="filter-end" class="form-input px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                        <select name="status" id="filter-status" class="form-input w-32 px-3 py-2 border border-gray-300 rounded-md">
                            <option value="">Alle</option>
                            <option value="pending">Ausstehend</option>
                            <option value="approved">Genehmigt</option>
                            <option value="rejected">Abgelehnt</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-primary ml-4">Filtern</button>
                </form>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-lg font-bold lackner-blue-text mb-4">Ausstehende Zeiteinträge</h2>
                <div class="overflow-x-auto max-h-96">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Mitarbeiter</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Datum</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Aufzug-ID</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tätigkeit</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Zeitraum</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Dauer</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Notdienstwoche</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Notizen</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Kommentar</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Aktionen</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for e in pending_entries %}
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-2">{{ e.mitarbeiter }}</td>
                                <td class="px-4 py-2">{{ e.date }}</td>
                                <td class="px-4 py-2">{{ e.elevator_id }}</td>
                                <td class="px-4 py-2">{{ e.task }}</td>
                                <td class="px-4 py-2">{{ e.time_range }}</td>
                                <td class="px-4 py-2">{{ e.duration }}</td>
                                <td class="px-4 py-2">{{ e.emergency_week }}</td>
                                <td class="px-4 py-2">{{ e.notes }}</td>
                                <td class="px-4 py-2">
                                    <span class="text-yellow-600 font-semibold">Ausstehend</span>
                                </td>
                                <td class="px-4 py-2">
                                    <form method="post" action="{{ url_for('comment_entry', id=e.id) }}">
                                        <input type="text" name="comment" value="{{ e.comment }}" class="form-input w-32 px-2 py-1 border border-gray-300 rounded-md">
                                        <button type="submit" class="text-blue-600 hover:underline ml-1">Speichern</button>
                                    </form>
                                </td>
                                <td class="px-4 py-2 flex space-x-2">
                                    <form method="post" action="{{ url_for('approve_entry', id=e.id) }}" style="display:inline;">
                                        <button type="submit" title="Genehmigen" class="text-green-600 hover:text-green-800 text-xl">✓</button>
                                    </form>
                                    <form method="post" action="{{ url_for('reject_entry', id=e.id) }}" style="display:inline;">
                                        <button type="submit" title="Ablehnen" class="text-red-600 hover:text-red-800 text-xl">✗</button>
                                    </form>
                                    {% if e.history %}
                                    <button type="button" class="details-toggle text-gray-500 hover:text-blue-600 text-lg ml-2" data-details-id="details-{{ e.id }}" title="Details anzeigen">
                                        <svg class="inline h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                    </button>
                                    {% endif %}
                                </td>
                            </tr>
                            {% if e.history %}
                            <tr id="details-{{ e.id }}" class="hidden"><td colspan="11" class="bg-gray-50 text-xs text-gray-500 p-2">
                                <strong>Protokoll:</strong>
                                <ul>
                                {% for h in e.history %}
                                    <li>{{ h.timestamp }} – {{ h.action }}{% if h.comment %}: {{ h.comment }}{% endif %}</li>
                                {% endfor %}
                                </ul>
                            </td></tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% if not pending_entries %}
                <div class="text-center text-gray-500 py-4">Keine ausstehenden Einträge.</div>
                {% endif %}
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-lg font-bold lackner-blue-text mb-4">Bereits beantwortete Zeiteinträge</h2>
                <div class="overflow-x-auto max-h-96">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Mitarbeiter</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Datum</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Aufzug-ID</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tätigkeit</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Zeitraum</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Dauer</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Notdienstwoche</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Notizen</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Kommentar</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Aktionen</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for e in answered_entries %}
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-2">{{ e.mitarbeiter }}</td>
                                <td class="px-4 py-2">{{ e.date }}</td>
                                <td class="px-4 py-2">{{ e.elevator_id }}</td>
                                <td class="px-4 py-2">{{ e.task }}</td>
                                <td class="px-4 py-2">{{ e.time_range }}</td>
                                <td class="px-4 py-2">{{ e.duration }}</td>
                                <td class="px-4 py-2">{{ e.emergency_week }}</td>
                                <td class="px-4 py-2">{{ e.notes }}</td>
                                <td class="px-4 py-2">
                                    {% if e.status == 'approved' %}
                                        <span class="text-green-600 font-semibold">Genehmigt</span>
                                    {% elif e.status == 'rejected' %}
                                        <span class="text-red-600 font-semibold">Abgelehnt</span>
                                    {% endif %}
                                </td>
                                <td class="px-4 py-2">
                                    <form method="post" action="{{ url_for('edit_entry_status', id=e.id) }}" style="display:inline;">
                                        <button type="submit" class="text-blue-600 hover:underline">Bearbeiten</button>
                                    </form>
                                    {% if e.history %}
                                    <button type="button" class="details-toggle text-gray-500 hover:text-blue-600 text-lg ml-2" data-details-id="details-{{ e.id }}" title="Details anzeigen">
                                        <svg class="inline h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                    </button>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td colspan="11" class="bg-gray-50 text-xs text-gray-500 p-2">
                                    <strong>Kommentar:</strong> {{ e.comment }}
                                </td>
                            </tr>
                            {% if e.history %}
                            <tr id="details-{{ e.id }}" class="hidden"><td colspan="11" class="bg-gray-50 text-xs text-gray-500 p-2">
                                <strong>Protokoll:</strong>
                                <ul>
                                {% for h in e.history %}
                                    <li>{{ h.timestamp }} – {{ h.action }}{% if h.comment %}: {{ h.comment }}{% endif %}</li>
                                {% endfor %}
                                </ul>
                            </td></tr>
                            {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% if not answered_entries %}
                <div class="text-center text-gray-500 py-4">Keine beantworteten Einträge.</div>
                {% endif %}
            </div>
        </main>
    </div>
    <script>
        // Notification Center Dropdown
        const bell = document.getElementById('notification-bell');
        const notifDropdown = document.getElementById('notification-dropdown');
        if (bell && notifDropdown) {
            bell.addEventListener('click', function(e) {
                e.stopPropagation();
                notifDropdown.classList.toggle('hidden');
            });
            document.addEventListener('click', function(e) {
                if (!notifDropdown.classList.contains('hidden') && !notifDropdown.contains(e.target) && e.target !== bell) {
                    notifDropdown.classList.add('hidden');
                }
            });
        }
        // Burger-Menü Dropdown
        const burgerBtn = document.getElementById('burger-menu-button');
        const burgerDropdown = document.getElementById('burger-dropdown');
        if (burgerBtn && burgerDropdown) {
            burgerBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                burgerDropdown.classList.toggle('hidden');
            });
            document.addEventListener('click', function(e) {
                if (!burgerDropdown.classList.contains('hidden') && !burgerDropdown.contains(e.target) && e.target !== burgerBtn) {
                    burgerDropdown.classList.add('hidden');
                }
            });
        }
        // Details-Toggle für Historie
        const detailToggles = document.querySelectorAll('.details-toggle');
        detailToggles.forEach(btn => {
            btn.addEventListener('click', function() {
                const id = btn.getAttribute('data-details-id');
                const row = document.getElementById(id);
                if (row) row.classList.toggle('hidden');
            });
        });
    </script>
</body>
</html> 