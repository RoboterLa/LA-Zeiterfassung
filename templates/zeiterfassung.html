 
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lackner Zeiterfassungssystem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --lackner-blue: #0066b3;
            --lackner-blue-dark: #005a9e;
            --lackner-gray: #6c757d;
        }
        body {
            font-family: 'Open Sans', sans-serif;
            margin: 0;
            background: #f8f9fa;
        }
        .lackner-blue {
            background: var(--lackner-blue);
        }
        .lackner-blue-text {
            color: var(--lackner-blue);
        }
        .lackner-gray {
            background: var(--lackner-gray);
        }
        .lackner-gray-text {
            color: var(--lackner-gray);
        }
        .btn-primary {
            background: var(--lackner-blue);
            color: white;
        }
        .btn-primary:hover {
            background: var(--lackner-blue-dark);
        }
        .form-input:focus {
            border-color: var(--lackner-blue);
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 102, 179, 0.2);
        }
        .activity-quick-select {
            transition: all 0.2s;
        }
        .activity-quick-select:hover {
            transform: translateY(-2px);
        }
        .activity-quick-select.selected {
            border-width: 2px;
            border-color: var(--lackner-blue);
            transform: translateY(-2px);
        }
        select.form-input {
            appearance: none;
            background-image: url("data:image/svg+xml;utf8,<svg fill='gray' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>");
            background-repeat: no-repeat;
            background-position: 98% 50%;
        }
        #edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 50;
            justify-content: center;
            align-items: center;
        }
        #edit-modal .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .logo-container {
            background: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .logo-container img {
            height: 48px;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-gray-100 min-h-screen">
    <header class="bg-[#0066b3] shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="logo-container flex items-center">
                <img src="https://lackner-aufzuege-gmbh.com/wp-content/uploads/2021/09/cropped-2205_lackner_r.png" alt="Lackner Aufzüge Logo" style="height:48px;">
            </div>
            <div class="flex items-center">
                <div class="text-white text-sm mr-4 hidden md:block">
                    <span id="current-date" class="mr-2">{{ today }}</span>
                    <span id="current-time"></span>
                </div>
                <div class="relative mr-4">
                    <button id="notification-bell" class="focus:outline-none">
                        <svg class="h-7 w-7 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                        </svg>
                        {% if pending_count > 0 %}
                        <span class="absolute -top-1 -right-1 bg-red-600 text-white text-xs font-bold rounded-full px-2 py-0.5 border-2 border-white">{{ pending_count }}</span>
                        {% endif %}
                    </button>
                    <div id="notification-dropdown" class="hidden absolute right-0 mt-2 w-72 bg-white rounded-md shadow-lg py-2 z-20">
                        <a href="{{ url_for('approve_entries') }}" class="block px-4 py-3 text-gray-800 hover:bg-gray-100 cursor-pointer">
                            {% if pending_count > 0 %}
                            <span class="font-semibold">Es gibt {{ pending_count }} Zeiteinträge, die genehmigt werden müssen.</span>
                            {% else %}
                            <span>Keine neuen Benachrichtigungen.</span>
                            {% endif %}
                        </a>
                    </div>
                </div>
                <div class="relative">
                    <button id="burger-menu-button" class="ml-2 flex items-center text-white focus:outline-none" aria-label="Menü öffnen">
                        <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                    <div id="burger-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-30">
                        <a href="{{ url_for('dashboard') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Dashboard</a>
                        <a href="{{ url_for('zeiterfassung') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Zeiterfassung</a>
                        <a href="{{ url_for('approve_entries') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Zeiteinträge genehmigen</a>
                        <a href="{{ url_for('urlaub') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Urlaubsübersicht</a>
                        <a href="{{ url_for('manage_users') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Benutzerverwaltung</a>
                        <a href="{{ url_for('meine_auftraege') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Meine Aufträge heute</a>
                        <a href="{{ url_for('arbeitszeit') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Arbeitszeit</a>
                        <a href="{{ url_for('logout') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Abmelden</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

        <main class="flex-grow container mx-auto px-4 py-6">
            <h1 class="text-2xl font-bold lackner-blue-text mb-6">Monteur Zeiterfassungssystem</h1>

            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-bold lackner-blue-text mb-4">Zeiteintrag</h2>
                <form id="time-entry-form" class="space-y-4">
                    <input type="hidden" id="entry-id" value="">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="elevator-id" class="block text-sm font-medium lackner-gray-text mb-1">Aufzug-ID*</label>
                            <input type="text" id="elevator-id" required placeholder="Aufzug-ID eingeben" class="form-input w-full px-4 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="location" class="block text-sm font-medium lackner-gray-text mb-1">Standort*</label>
                            <input type="text" id="location" required placeholder="Standort eingeben (z. B. Berlin Hauptbahnhof)" class="form-input w-full px-4 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="entry-date" class="block text-sm font-medium lackner-gray-text mb-1">Datum*</label>
                            <input type="date" id="entry-date" required value="2025-07-15" class="form-input w-full px-4 py-2 border border-gray-300 rounded-md">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium lackner-gray-text mb-2">Tätigkeitsart*</label>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                            <div class="activity-quick-select border rounded-md p-3 cursor-pointer selected border-blue-500" data-activity="maintenance">
                                <div class="flex items-center">
                                    <svg class="h-5 w-5 mr-2 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    <span>Wartung</span>
                                </div>
                            </div>
                            <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="repairs">
                                <div class="flex items-center">
                                    <svg class="h-5 w-5 mr-2 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                                    </svg>
                                    <span>Reparatur</span>
                                </div>
                            </div>
                            <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="fixedprice">
                                <div class="flex items-center">
                                    <svg class="h-5 w-5 mr-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l-1 1m0 0l-1-1m1 1v12m-4-6H3m18 0h-3m-4 6H3m18 0h-3" />
                                    </svg>
                                    <span>Festpreis</span>
                                </div>
                            </div>
                            <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="emergency">
                                <div class="flex items-center">
                                    <svg class="h-5 w-5 mr-2 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span>Notdienst</span>
                                </div>
                            </div>
                            <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="office">
                                <div class="flex items-center">
                                    <svg class="h-5 w-5 mr-2 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                    </svg>
                                    <span>Büro</span>
                                </div>
                            </div>
                            <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="sick">
                                <div class="flex items-center">
                                    <svg class="h-5 w-5 mr-2 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m-6 4h8m-4-8v8" />
                                    </svg>
                                    <span>Krank</span>
                                </div>
                            </div>
                            <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="vacation">
                                <div class="flex items-center">
                                    <svg class="h-5 w-5 mr-2 text-teal-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4m14 0h-4m4 0v4m-9 7v6m-3-3h6" />
                                    </svg>
                                    <span>Urlaub</span>
                                </div>
                            </div>
                            <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="holiday">
                                <div class="flex items-center">
                                    <svg class="h-5 w-5 mr-2 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 9.143l-5.714 2.286 2.286 5.714L12 15.857l-5.714 2.286 2.286-5.714L3 9.143l5.714-2.286L11 3z"></path>
                                    </svg>
                                    <span>Feiertag</span>
                                </div>
                            </div>
                            <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="overtime">
                                <div class="flex items-center">
                                    <svg class="h-5 w-5 mr-2 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                                    </svg>
                                    <span>Überstunden</span>
                                </div>
                            </div>
                            <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="other">
                                <div class="flex items-center">
                                    <svg class="h-5 w-5 mr-2 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                                    </svg>
                                    <span>Sonstige</span>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="activity-type" required value="maintenance">
                        <div class="mt-2">
                            <label for="other-activity" class="block text-sm font-medium lackner-gray-text mb-1">Sonstige Tätigkeit</label>
                            <input type="text" id="other-activity" placeholder="Andere Tätigkeitsart angeben" class="form-input w-full px-4 py-2 border border-gray-300 rounded-md">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="start-time" class="block text-sm font-medium lackner-gray-text mb-1">Startzeit*</label>
                            <select id="start-time" required class="form-input w-full px-4 py-2 border border-gray-300 rounded-md">
                                {% for hour in range(0, 24) %}
                                    {% for minute in [0, 30] %}
                                        {% set time = "%02d:%02d" | format(hour, minute) %}
                                        <option value="{{ time }}">{{ time }}</option>
                                    {% endfor %}
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label for="end-time" class="block text-sm font-medium lackner-gray-text mb-1">Endzeit*</label>
                            <select id="end-time" required class="form-input w-full px-4 py-2 border border-gray-300 rounded-md">
                                {% for hour in range(0, 24) %}
                                    {% for minute in [0, 30] %}
                                        {% set time = "%02d:%02d" | format(hour, minute) %}
                                        <option value="{{ time }}" {% if time == "17:00" %}selected{% endif %}>{{ time }}</option>
                                    {% endfor %}
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium lackner-gray-text mb-2">Notdienstwoche*</label>
                        <div class="flex space-x-4">
                            <label class="flex items-center"><input type="radio" name="emergency-week" value="yes" required class="mr-2">Ja</label>
                            <label class="flex items-center"><input type="radio" name="emergency-week" value="no" class="mr-2" checked>Nein</label>
                        </div>
                    </div>

                    <div>
                        <label for="notes" class="block text-sm font-medium lackner-gray-text mb-1">Notizen</label>
                        <textarea id="notes" rows="3" placeholder="Details zur durchgeführten Arbeit..." class="form-input w-full px-4 py-2 border border-gray-300 rounded-md"></textarea>
                    </div>

                    <div class="flex justify-end space-x-3">
                        <button type="button" id="reset-form" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-400" aria-label="Formular zurücksetzen">Zurücksetzen</button>
                        <button type="submit" class="btn-primary px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Eintrag speichern"><span id="submit-text">Eintrag speichern</span></button>
                    </div>
                </form>
            </div>

            <div id="edit-modal">
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold lackner-blue-text">Zeiteintrag bearbeiten</h2>
                        <button id="close-edit-modal" class="text-gray-500 hover:text-gray-700" aria-label="Modal schließen">
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    <form id="edit-time-entry-form" class="space-y-4">
                        <input type="hidden" id="edit-entry-id" value="">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="edit-elevator-id" class="block text-sm font-medium lackner-gray-text mb-1">Aufzug-ID*</label>
                                <input type="text" id="edit-elevator-id" required placeholder="Aufzug-ID eingeben" class="form-input w-full px-4 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label for="edit-location" class="block text-sm font-medium lackner-gray-text mb-1">Standort*</label>
                                <input type="text" id="edit-location" required placeholder="Standort eingeben (z. B. Berlin Hauptbahnhof)" class="form-input w-full px-4 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label for="edit-entry-date" class="block text-sm font-medium lackner-gray-text mb-1">Datum*</label>
                                <input type="date" id="edit-entry-date" required class="form-input w-full px-4 py-2 border border-gray-300 rounded-md">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium lackner-gray-text mb-2">Tätigkeitsart*</label>
                            <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                                <div class="activity-quick-select border rounded-md p-3 cursor-pointer selected border-blue-500" data-activity="maintenance">
                                    <div class="flex items-center">
                                        <svg class="h-5 w-5 mr-2 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                        <span>Wartung</span>
                                    </div>
                                </div>
                                <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="repairs">
                                    <div class="flex items-center">
                                        <svg class="h-5 w-5 mr-2 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                                        </svg>
                                        <span>Reparatur</span>
                                    </div>
                                </div>
                                <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="fixedprice">
                                    <div class="flex items-center">
                                        <svg class="h-5 w-5 mr-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l-1 1m0 0l-1-1m1 1v12m-4-6H3m18 0h-3m-4 6H3m18 0h-3" />
                                        </svg>
                                        <span>Festpreis</span>
                                    </div>
                                </div>
                                <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="emergency">
                                    <div class="flex items-center">
                                        <svg class="h-5 w-5 mr-2 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <span>Notdienst</span>
                                    </div>
                                </div>
                                <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="office">
                                    <div class="flex items-center">
                                        <svg class="h-5 w-5 mr-2 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                        </svg>
                                        <span>Büro</span>
                                    </div>
                                </div>
                                <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="sick">
                                    <div class="flex items-center">
                                        <svg class="h-5 w-5 mr-2 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m-6 4h8m-4-8v8" />
                                        </svg>
                                        <span>Krank</span>
                                    </div>
                                </div>
                                <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="vacation">
                                    <div class="flex items-center">
                                        <svg class="h-5 w-5 mr-2 text-teal-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4m14 0h-4m4 0v4m-9 7v6m-3-3h6" />
                                        </svg>
                                        <span>Urlaub</span>
                                    </div>
                                </div>
                                <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="holiday">
                                    <div class="flex items-center">
                                        <svg class="h-5 w-5 mr-2 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 9.143l-5.714 2.286 2.286 5.714L12 15.857l-5.714 2.286 2.286-5.714L3 9.143l5.714-2.286L11 3z"></path>
                                        </svg>
                                        <span>Feiertag</span>
                                    </div>
                                </div>
                                <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="overtime">
                                    <div class="flex items-center">
                                        <svg class="h-5 w-5 mr-2 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                                        </svg>
                                        <span>Überstunden</span>
                                    </div>
                                </div>
                                <div class="activity-quick-select border rounded-md p-3 cursor-pointer" data-activity="other">
                                    <div class="flex items-center">
                                        <svg class="h-5 w-5 mr-2 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                                    </svg>
                                    <span>Sonstige</span>
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" id="edit-activity-type" required value="">
                            <div class="mt-2">
                                <label for="edit-other-activity" class="block text-sm font-medium lackner-gray-text mb-1">Sonstige Tätigkeit</label>
                                <input type="text" id="edit-other-activity" placeholder="Andere Tätigkeitsart angeben" class="form-input w-full px-4 py-2 border border-gray-300 rounded-md">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="edit-start-time" class="block text-sm font-medium lackner-gray-text mb-1">Startzeit*</label>
                                <select id="edit-start-time" required class="form-input w-full px-4 py-2 border border-gray-300 rounded-md">
                                    {% for hour in range(0, 24) %}
                                        {% for minute in [0, 30] %}
                                            {% set time = "%02d:%02d" | format(hour, minute) %}
                                            <option value="{{ time }}">{{ time }}</option>
                                        {% endfor %}
                                    {% endfor %}
                                </select>
                            </div>
                            <div>
                                <label for="edit-end-time" class="block text-sm font-medium lackner-gray-text mb-1">Endzeit*</label>
                                <select id="edit-end-time" required class="form-input w-full px-4 py-2 border border-gray-300 rounded-md">
                                    {% for hour in range(0, 24) %}
                                        {% for minute in [0, 30] %}
                                            {% set time = "%02d:%02d" | format(hour, minute) %}
                                            <option value="{{ time }}" {% if time == "17:00" %}selected{% endif %}>{{ time }}</option>
                                        {% endfor %}
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium lackner-gray-text mb-2">Notdienstwoche*</label>
                            <div class="flex space-x-4">
                                <label class="flex items-center"><input type="radio" name="edit-emergency-week" value="yes" required class="mr-2">Ja</label>
                                <label class="flex items-center"><input type="radio" name="edit-emergency-week" value="no" class="mr-2">Nein</label>
                            </div>
                        </div>

                        <div>
                            <label for="edit-notes" class="block text-sm font-medium lackner-gray-text mb-1">Notizen</label>
                            <textarea id="edit-notes" rows="3" placeholder="Details zur durchgeführten Arbeit..." class="form-input w-full px-4 py-2 border border-gray-300 rounded-md"></textarea>
                        </div>

                        <div class="flex justify-end space-x-3">
                            <button type="button" id="cancel-edit" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-400" aria-label="Bearbeitung abbrechen">Abbrechen</button>
                            <button type="submit" class="btn-primary px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Änderungen speichern">Änderungen speichern</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 space-y-3 md:space-y-0">
                    <h2 class="text-xl font-bold lackner-blue-text">Zeitprotokoll</h2>
                    <div class="flex space-x-2">
                        <a id="export-log" href="/export" class="btn-primary px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center" aria-label="Zeitprotokoll als CSV exportieren">
                            <svg class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            CSV exportieren
                        </a>
                    </div>
                </div>

                <div class="mb-4 bg-gray-50 p-4 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="font-medium text-gray-700">Filter</h3>
                        <button id="toggle-filters" class="text-sm text-blue-600 hover:text-blue-800 focus:outline-none" aria-label="Erweiterte Filter ein-/ausblenden">
                            <span id="filter-toggle-text">Erweitert anzeigen</span>
                            <svg class="h-4 w-4 inline ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <div>
                            <label for="filter-text" class="block text-xs font-medium text-gray-500 mb-1">Suche</label>
                            <input type="text" id="filter-text" placeholder="Suchen..." class="form-input w-full px-3 py-1.5 text-sm border border-gray-300 rounded-md" aria-label="Nach Einträgen suchen">
                        </div>
                        <div>
                            <label for="filter-activity" class="block text-xs font-medium text-gray-500 mb-1">Tätigkeit</label>
                            <select id="filter-activity" class="form-input w-full px-3 py-1.5 text-sm border border-gray-300 rounded-md" aria-label="Tätigkeit auswählen">
                                <option value="">Alle Tätigkeiten</option>
                                <option value="maintenance">Wartung</option>
                                <option value="repairs">Reparatur</option>
                                <option value="fixedprice">Festpreis</option>
                                <option value="emergency">Notdienst</option>
                                <option value="office">Büro</option>
                                <option value="sick">Krank</option>
                                <option value="vacation">Urlaub</option>
                                <option value="holiday">Feiertag</option>
                                <option value="overtime">Überstunden</option>
                                <option value="other">Sonstige</option>
                            </select>
                        </div>
                        <div>
                            <label for="filter-elevator" class="block text-xs font-medium text-gray-500 mb-1">Aufzug-ID</label>
                            <select id="filter-elevator" class="form-input w-full px-3 py-1.5 text-sm border border-gray-300 rounded-md" aria-label="Aufzug-ID auswählen">
                                <option value="">Alle Aufzüge</option>
                            </select>
                        </div>
                    </div>

                    <div id="advanced-filters" class="mt-3 pt-3 border-t border-gray-200 hidden">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <div>
                                <label for="filter-date-type" class="block text-xs font-medium text-gray-500 mb-1">Datumsfilter</label>
                                <select id="filter-date-type" class="form-input w-full px-3 py-1.5 text-sm border border-gray-300 rounded-md" aria-label="Datumsfilter auswählen">
                                    <option value="all">Alle Daten</option>
                                    <option value="today">Heute</option>
                                    <option value="yesterday">Gestern</option>
                                    <option value="custom">Benutzerdefinierter Zeitraum</option>
                                </select>
                            </div>
                            <div id="filter-date-start-container" class="hidden">
                                <label for="filter-date-start" class="block text-xs font-medium text-gray-500 mb-1">Startdatum</label>
                                <input type="date" id="filter-date-start" class="form-input w-full px-3 py-1.5 text-sm border border-gray-300 rounded-md" aria-label="Startdatum auswählen">
                            </div>
                            <div id="filter-date-end-container" class="hidden">
                                <label for="filter-date-end" class="block text-xs font-medium text-gray-500 mb-1">Enddatum</label>
                                <input type="date" id="filter-date-end" class="form-input w-full px-3 py-1.5 text-sm border border-gray-300 rounded-md" aria-label="Enddatum auswählen">
                            </div>
                        </div>
                        <div class="mt-3 flex justify-end">
                            <button id="clear-filters" class="text-sm text-gray-600 hover:text-gray-800 mr-3" aria-label="Filter zurücksetzen">Filter zurücksetzen</button>
                            <button id="apply-filters" class="text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded hover:bg-blue-200" aria-label="Filter anwenden">Filter anwenden</button>
                        </div>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Datum</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aufzug-ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tätigkeit</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Zeitraum</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Dauer</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Notdienstwoche</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Notizen</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="time-log-body" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <div id="no-entries" class="text-center py-4 text-gray-500 hidden">Keine Zeiteinträge gefunden.</div>
            </div>
        </main>

        <footer class="lackner-gray text-white py-4 mt-6">
            <div class="container mx-auto px-4 text-center text-sm">
                <p>© 2025 Lackner Aufzüge GmbH - Monteur Zeiterfassungssystem</p>
            </div>
        </footer>
    </div>

    <div id="notification" class="fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center">
        <svg class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
        </svg>
        <span id="notification-message">Eintrag erfolgreich gespeichert!</span>
    </div>

    <script>
        const activityLabels = {
            'maintenance': 'Wartung',
            'repairs': 'Reparatur',
            'fixedprice': 'Festpreis',
            'emergency': 'Notdienst',
            'office': 'Büro',
            'sick': 'Krank',
            'vacation': 'Urlaub',
            'holiday': 'Feiertag',
            'overtime': 'Überstunden',
            'other': 'Sonstige'
        };

        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            loadEntries();

            // Set current time for start-time
            const now = new Date();
            let hours = now.getHours().toString().padStart(2, '0');
            let minutes = Math.round(now.getMinutes() / 30) * 30;
            if (minutes === 60) {
                minutes = 0;
                hours = ((parseInt(hours) + 1) % 24).toString().padStart(2, '0');
            }
            const currentTime = `${hours}:${minutes.toString().padStart(2, '0')}`;
            document.getElementById('start-time').value = currentTime;

            document.getElementById('notification-bell').addEventListener('click', function() {
                document.getElementById('notification-dropdown').classList.toggle('hidden');
            });
            document.addEventListener('click', function(event) {
                const dropdown = document.getElementById('notification-dropdown');
                const bellButton = document.getElementById('notification-bell');
                if (!dropdown.contains(event.target) && !bellButton.contains(event.target)) {
                    dropdown.classList.add('hidden');
                }
            });

            document.getElementById('burger-menu-button').addEventListener('click', function() {
                document.getElementById('burger-dropdown').classList.toggle('hidden');
            });
            document.addEventListener('click', function(event) {
                const dropdown = document.getElementById('burger-dropdown');
                const burgerButton = document.getElementById('burger-menu-button');
                if (!dropdown.contains(event.target) && !burgerButton.contains(event.target)) {
                    dropdown.classList.add('hidden');
                }
            });

            document.getElementById('toggle-filters').addEventListener('click', function() {
                const advancedFilters = document.getElementById('advanced-filters');
                const toggleText = document.getElementById('filter-toggle-text');
                if (advancedFilters.classList.contains('hidden')) {
                    advancedFilters.classList.remove('hidden');
                    toggleText.textContent = 'Erweitert ausblenden';
                } else {
                    advancedFilters.classList.add('hidden');
                    toggleText.textContent = 'Erweitert anzeigen';
                }
            });

            document.getElementById('filter-date-type').addEventListener('change', function() {
                const startContainer = document.getElementById('filter-date-start-container');
                const endContainer = document.getElementById('filter-date-end-container');
                if (this.value === 'custom') {
                    startContainer.classList.remove('hidden');
                    endContainer.classList.remove('hidden');
                } else {
                    startContainer.classList.add('hidden');
                    endContainer.classList.add('hidden');
                }
            });

            document.querySelectorAll('#time-entry-form .activity-quick-select').forEach(button => {
                button.addEventListener('click', function() {
                    const activity = this.getAttribute('data-activity');
                    document.querySelectorAll('#time-entry-form .activity-quick-select').forEach(btn => {
                        btn.classList.remove('selected', 'border-blue-500');
                    });
                    this.classList.add('selected', 'border-blue-500');
                    document.getElementById('activity-type').value = activity;
                    if (activity !== 'other') document.getElementById('other-activity').value = '';
                });
            });

            document.getElementById('other-activity').addEventListener('input', function() {
                if (this.value.trim() !== '') {
                    document.querySelectorAll('#time-entry-form .activity-quick-select').forEach(btn => {
                        btn.classList.remove('selected', 'border-blue-500');
                    });
                    const otherButton = document.querySelector('#time-entry-form .activity-quick-select[data-activity="other"]');
                    otherButton.classList.add('selected', 'border-blue-500');
                    document.getElementById('activity-type').value = 'other';
                }
            });

            document.querySelectorAll('#edit-time-entry-form .activity-quick-select').forEach(button => {
                button.addEventListener('click', function() {
                    const activity = this.getAttribute('data-activity');
                    document.querySelectorAll('#edit-time-entry-form .activity-quick-select').forEach(btn => {
                        btn.classList.remove('selected', 'border-blue-500');
                    });
                    this.classList.add('selected', 'border-blue-500');
                    document.getElementById('edit-activity-type').value = activity;
                    if (activity !== 'other') document.getElementById('edit-other-activity').value = '';
                });
            });

            document.getElementById('edit-other-activity').addEventListener('input', function() {
                if (this.value.trim() !== '') {
                    document.querySelectorAll('#edit-time-entry-form .activity-quick-select').forEach(btn => {
                        btn.classList.remove('selected', 'border-blue-500');
                    });
                    const otherButton = document.querySelector('#edit-time-entry-form .activity-quick-select[data-activity="other"]');
                    otherButton.classList.add('selected', 'border-blue-500');
                    document.getElementById('edit-activity-type').value = 'other';
                }
            });

            let debounceTimeout;
            document.getElementById('filter-text').addEventListener('input', function() {
                clearTimeout(debounceTimeout);
                debounceTimeout = setTimeout(loadEntries, 500);
            });
            document.getElementById('filter-activity').addEventListener('change', function() {
                clearTimeout(debounceTimeout);
                debounceTimeout = setTimeout(loadEntries, 500);
            });
            document.getElementById('filter-elevator').addEventListener('change', function() {
                clearTimeout(debounceTimeout);
                debounceTimeout = setTimeout(loadEntries, 500);
            });
            document.getElementById('apply-filters').addEventListener('click', loadEntries);
            document.getElementById('clear-filters').addEventListener('click', clearFilters);
            document.getElementById('time-entry-form').addEventListener('submit', handleFormSubmit);
            document.getElementById('edit-time-entry-form').addEventListener('submit', handleEditFormSubmit);
            document.getElementById('reset-form').addEventListener('click', resetForm);
            document.getElementById('close-edit-modal').addEventListener('click', closeEditModal);
            document.getElementById('cancel-edit').addEventListener('click', closeEditModal);

            // Vorbefüllung aus URL-Parameter
            const params = new URLSearchParams(window.location.search);
            const auftrag = params.get('auftrag');
            if (auftrag) {
                // Mapping für Art → activity-type
                const artMap = {
                    'Reparatur': 'repairs',
                    'Wartung': 'maintenance',
                    'Modernisierung': 'fixedprice',
                    'Notdienst': 'emergency',
                    'Büro': 'office',
                    'Krank': 'sick',
                    'Urlaub': 'vacation',
                    'Feiertag': 'holiday',
                    'Überstunden': 'overtime',
                    'Sonstige': 'other',
                    'Festpreis': 'fixedprice'
                };
                let art = '', standort = '';
                let parts = auftrag.split(':');
                if (parts.length === 2) {
                    art = parts[0].trim();
                    standort = parts[1].trim();
                } else {
                    parts = auftrag.trim().split(' ');
                    art = parts[0];
                    standort = parts.slice(1).join(' ');
                }
                const mapped = artMap[art] || 'other';
                console.log('[Vorbefüllung] auftrag:', auftrag, '| erkannte Art:', art, '| Standort:', standort, '| mapped activity-type:', mapped);
                // Setze Standort
                if (document.getElementById('location')) document.getElementById('location').value = standort;
                // Setze Tätigkeitsart (Quick-Select)
                document.getElementById('activity-type').value = mapped;
                document.querySelectorAll('#time-entry-form .activity-quick-select').forEach(btn => {
                    btn.classList.remove('selected', 'border-blue-500');
                    if (btn.getAttribute('data-activity') === mapped) {
                        btn.classList.add('selected', 'border-blue-500');
                    }
                });
                // Debug: Logge die gesetzten Werte
                setTimeout(() => {
                    console.log('[Vorbefüllung] Nach Setzen: Standort:', document.getElementById('location').value, '| activity-type:', document.getElementById('activity-type').value);
                }, 100);
            }
        });

        function updateDateTime() {
            const now = new Date();
            document.getElementById('current-date').textContent = now.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' });
            document.getElementById('current-time').textContent = now.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
        }

        async function loadEntries() {
            const filterText = document.getElementById('filter-text').value;
            const filterActivity = document.getElementById('filter-activity').value;
            const filterElevator = document.getElementById('filter-elevator').value;
            const filterDateType = document.getElementById('filter-date-type').value;
            const filterDateStart = document.getElementById('filter-date-start').value;
            const filterDateEnd = document.getElementById('filter-date-end').value;

            const params = new URLSearchParams({
                filter_text: filterText,
                filter_activity: filterActivity,
                filter_elevator: filterElevator,
                filter_date_type: filterDateType,
                filter_date_start: filterDateStart,
                filter_date_end: filterDateEnd
            });

            try {
                const response = await fetch(`/entries?${params.toString()}`);
                const data = await response.json();
                const entries = data.entries;

                const tbody = document.getElementById('time-log-body');
                tbody.innerHTML = '';

                if (entries.length === 0) {
                    document.getElementById('no-entries').classList.remove('hidden');
                } else {
                    document.getElementById('no-entries').classList.add('hidden');
                    entries.forEach(entry => {
                        const date = new Date(entry.date);
                        const formattedDate = date.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' });
                        const taskLabel = activityLabels[entry.task] || entry.task;
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formattedDate}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${entry.elevator_id}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${taskLabel}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${entry.time_range}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${entry.duration}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${entry.emergency_week}</td>
                            <td class="px-6 py-4 text-sm text-gray-500">${entry.notes}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${entry.status === 'pending' ? 'Ausstehend' : entry.status === 'approved' ? 'Genehmigt' : 'Abgelehnt'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                <button class="edit-entry text-blue-600 hover:text-blue-800 mr-2" data-id="${entry.id}" aria-label="Eintrag bearbeiten">Bearbeiten</button>
                                <button class="delete-entry text-red-600 hover:text-red-800" data-id="${entry.id}" aria-label="Eintrag löschen">Löschen</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                }

                const elevatorSelect = document.getElementById('filter-elevator');
                const currentValue = elevatorSelect.value;
                elevatorSelect.innerHTML = '<option value="">Alle Aufzüge</option>';
                data.elevator_ids.slice(0, 100).forEach(id => {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = id;
                    if (id === currentValue) option.selected = true;
                    elevatorSelect.appendChild(option);
                });

                document.querySelectorAll('.edit-entry').forEach(button => {
                    button.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        editEntry(id);
                    });
                });

                document.querySelectorAll('.delete-entry').forEach(button => {
                    button.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        deleteEntry(id);
                    });
                });
            } catch (error) {
                console.error('Fehler beim Laden der Einträge:', error);
                showNotification('Fehler beim Laden der Einträge. Möglicherweise ist der Server überlastet.', 'error');
            }
        }

        async function handleFormSubmit(event) {
            event.preventDefault();
            const startTime = document.getElementById('start-time').value;
            const endTime = document.getElementById('end-time').value;
            if (startTime >= endTime) {
                showNotification('Die Endzeit muss nach der Startzeit liegen.', 'error');
                return;
            }
            const data = {
                elevator_id: document.getElementById('elevator-id').value,
                location: document.getElementById('location').value,
                entry_date: document.getElementById('entry-date').value,
                activity_type: document.getElementById('activity-type').value,
                other_activity: document.getElementById('other-activity').value,
                start_time: startTime,
                end_time: endTime,
                emergency_week: document.querySelector('input[name="emergency-week"]:checked').value,
                notes: document.getElementById('notes').value
            };

            try {
                const response = await fetch('/add_entry', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                if (result.status === 'success') {
                    showNotification(result.message, 'success');
                    resetForm();
                    loadEntries();
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                console.error('Fehler beim Speichern des Eintrags:', error);
                showNotification('Fehler beim Speichern des Eintrags. Möglicherweise ist der Server überlastet.', 'error');
            }
        }

        async function handleEditFormSubmit(event) {
            event.preventDefault();
            const startTime = document.getElementById('edit-start-time').value;
            const endTime = document.getElementById('edit-end-time').value;
            if (startTime >= endTime) {
                showNotification('Die Endzeit muss nach der Startzeit liegen.', 'error');
                return;
            }
            const id = document.getElementById('edit-entry-id').value;
            const data = {
                elevator_id: document.getElementById('edit-elevator-id').value,
                location: document.getElementById('edit-location').value,
                entry_date: document.getElementById('edit-entry-date').value,
                activity_type: document.getElementById('edit-activity-type').value,
                other_activity: document.getElementById('edit-other-activity').value,
                start_time: startTime,
                end_time: endTime,
                emergency_week: document.querySelector('input[name="edit-emergency-week"]:checked').value,
                notes: document.getElementById('edit-notes').value
            };

            try {
                const response = await fetch(`/edit_entry/${id}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                if (result.status === 'success') {
                    showNotification(result.message, 'success');
                    closeEditModal();
                    loadEntries();
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                console.error('Fehler beim Aktualisieren des Eintrags:', error);
                showNotification('Fehler beim Aktualisieren des Eintrags. Möglicherweise ist der Server überlastet.', 'error');
            }
        }

        async function editEntry(id) {
            try {
                const response = await fetch('/entries');
                const data = await response.json();
                const entry = data.entries.find(e => e.id == id);
                if (entry) {
                    document.getElementById('edit-entry-id').value = entry.id;
                    document.getElementById('edit-elevator-id').value = entry.elevator_id;
                    document.getElementById('edit-location').value = entry.location;
                    document.getElementById('edit-entry-date').value = entry.date;

                    const [startTime, endTime] = entry.time_range.split(' - ');
                    document.getElementById('edit-start-time').value = startTime;
                    document.getElementById('edit-end-time').value = endTime;

                    document.querySelector(`input[name="edit-emergency-week"][value="${entry.emergency_week === 'Ja' ? 'yes' : 'no'}"]`).checked = true;
                    document.getElementById('edit-notes').value = entry.notes;

                    const taskKey = Object.keys(activityLabels).find(key => activityLabels[key] === entry.task) || 'other';
                    const activity = taskKey !== 'other' ? taskKey : 'other';
                    document.querySelectorAll('#edit-time-entry-form .activity-quick-select').forEach(btn => {
                        btn.classList.remove('selected', 'border-blue-500');
                    });
                    const activityButton = document.querySelector(`#edit-time-entry-form .activity-quick-select[data-activity="${activity}"]`);
                    activityButton.classList.add('selected', 'border-blue-500');
                    document.getElementById('edit-activity-type').value = activity;
                    document.getElementById('edit-other-activity').value = activity === 'other' ? entry.task : '';

                    document.getElementById('edit-modal').style.display = 'flex';
                }
            } catch (error) {
                console.error('Fehler beim Laden des Eintrags zum Bearbeiten:', error);
                showNotification('Fehler beim Laden des Eintrags. Möglicherweise ist der Server überlastet.', 'error');
            }
        }

        async function deleteEntry(id) {
            if (!confirm('Sind Sie sicher, dass Sie diesen Eintrag löschen möchten?')) return;
            try {
                const response = await fetch(`/delete_entry/${id}`, { method: 'DELETE' });
                const result = await response.json();
                if (result.status === 'success') {
                    showNotification(result.message, 'success');
                    loadEntries();
                } else {
                    showNotification(result.message, 'error');
                }
            } catch (error) {
                console.error('Fehler beim Löschen des Eintrags:', error);
                showNotification('Fehler beim Löschen des Eintrags. Möglicherweise ist der Server überlastet.', 'error');
            }
        }

        function resetForm() {
            const form = document.getElementById('time-entry-form');
            form.reset();
            document.getElementById('entry-date').value = new Date().toISOString().split('T')[0];
            const now = new Date();
            let hours = now.getHours().toString().padStart(2, '0');
            let minutes = Math.round(now.getMinutes() / 30) * 30;
            if (minutes === 60) {
                minutes = 0;
                hours = ((parseInt(hours) + 1) % 24).toString().padStart(2, '0');
            }
            document.getElementById('start-time').value = `${hours}:${minutes.toString().padStart(2, '0')}`;
            document.getElementById('end-time').value = '17:00';
            document.querySelector('input[name="emergency-week"][value="no"]').checked = true;
            document.querySelectorAll('#time-entry-form .activity-quick-select').forEach(btn => {
                btn.classList.remove('selected', 'border-blue-500');
            });
            const maintenanceButton = document.querySelector('#time-entry-form .activity-quick-select[data-activity="maintenance"]');
            maintenanceButton.classList.add('selected', 'border-blue-500');
            document.getElementById('activity-type').value = 'maintenance';
            document.getElementById('other-activity').value = '';
        }

        function closeEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
        }

        function clearFilters() {
            document.getElementById('filter-text').value = '';
            document.getElementById('filter-activity').value = '';
            document.getElementById('filter-elevator').value = '';
            document.getElementById('filter-date-type').value = 'all';
            document.getElementById('filter-date-start').value = '';
            document.getElementById('filter-date-end').value = '';
            document.getElementById('filter-date-start-container').classList.add('hidden');
            document.getElementById('filter-date-end-container').classList.add('hidden');
            loadEntries();
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const messageSpan = document.getElementById('notification-message');
            messageSpan.textContent = message;

            notification.classList.remove('bg-green-500', 'bg-red-500', 'translate-y-20', 'opacity-0');
            notification.classList.add(type === 'success' ? 'bg-green-500' : 'bg-red-500', 'translate-y-0', 'opacity-100');

            setTimeout(() => {
                notification.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }
    </script>
</body>
</html>